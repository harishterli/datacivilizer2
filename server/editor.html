<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DC2 Editor</title>
    <meta name="description"
          content="Drag a link to reconnect it. Nodes have custom Adornments for selection, resizing, and rotating.  The Palette includes links."/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Copyright 1998-2019 by Northwoods Software Corporation. -->
    <script src="/go.js"></script>
    <script src="/Figures.js"></script>
    <script src="/dragscroll.js"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='/DataInspector.css'/>
    <script src="/versioningUtils.js"></script>
    <script src="/vizUtils.js"></script>
    <script src="/modelsvisualizerUtils.js"></script>
    <script src="/debuggerUtils.js"></script>
    <script src="/trackingUtils.js"></script>
    <script src="/DataInspector.js"></script>
    <script src="/Chart.js"></script>
    <script src="/ejs_production.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script id="code">

        var source = new EventSource('./registerEditor');

        source.onmessage = function (event) {
            console.log(JSON.parse(event.data).data);
        };

        source.addEventListener('split_update', (e) => {
            update_running_pipeline(JSON.parse(event.data));
        });

        source.addEventListener('tracking_update', (e) => {
            add_tracking_ids(JSON.parse(event.data));
        });

        source.addEventListener('finish_run', (e) => {
            finish_running_pipeline(JSON.parse(event.data));
        });

        // dynamically changing iframe size
        function iFrameJsonParams() {
            var iFrameWidthString = localStorage.getItem("widthLocalStorage");
            var iFrameHeightString = localStorage.getItem("heightLocalStorage");
            var iFrameWidthNumber = Number(iFrameWidthString);
            var iFrameHeightNumber = Number(iFrameHeightString) + 10;
            document.getElementById('iframeViz').style.width = iFrameWidthNumber + 'px';
            document.getElementById('iframeViz').style.height = iFrameHeightNumber + 'px';
        };

        function iFrameImageParams() {
            var iframe = document.getElementById('iframeViz');
            var innerDoc = iframe.contentWindow.document;
            var myRegexp = /.+\s.(\d+)\s?.\s?(\d+)./;
            var match = myRegexp.exec(innerDoc.title);
            document.getElementById('iframeViz').style.width = Number(match[1]) + 'px';
            document.getElementById('iframeViz').style.height = Number(match[2]) + 'px';
        };

        var running_models = []
        var models = {};
        var modules_info;
        var filter_parameters = [];
        var filter_metrics = [];

        function init() {

            if (window.goSamples) goSamples(); // init for these samples -- you don't need to call this
            var GOJS = go.GraphObject.make; // for conciseness in defining templates

            go.licenseKey = "54f041e0b11c28c702d90776423d6bf919a57a63c8841aa30e0442f6b9086d1c249dee6a41d5dc90d7f81baf4a2995dbdec56a7992495132e43480de16e286fee7347aa0040e12dea203749398e83aa2fd7879edc7aa77a5";

            myDiagram =
                GOJS(go.Diagram, "myDiagramDiv", // must name or refer to the DIV HTML element
                    {
                        "draggingTool.dragsLink": true,
                        "draggingTool.isGridSnapEnabled": false,
                        "linkingTool.isUnconnectedLinkValid": false,
                        "linkingTool.portGravity": 20,
                        "relinkingTool.isUnconnectedLinkValid": true,
                        "relinkingTool.portGravity": 20,
                        "relinkingTool.fromHandleArchetype": GOJS(go.Shape, "Diamond", {
                            segmentIndex: 0,
                            cursor: "pointer",
                            desiredSize: new go.Size(8, 8),
                            fill: "tomato",
                            stroke: "darkred"
                        }),
                        "relinkingTool.toHandleArchetype": GOJS(go.Shape, "Diamond", {
                            segmentIndex: -1,
                            cursor: "pointer",
                            desiredSize: new go.Size(8, 8),
                            fill: "darkred",
                            stroke: "tomato"
                        }),
                        "linkReshapingTool.handleArchetype": GOJS(go.Shape, "Diamond", {
                            desiredSize: new go.Size(7, 7),
                            fill: "lightblue",
                            stroke: "deepskyblue"
                        }),
                        "rotatingTool.handleAngle": 270,
                        "rotatingTool.handleDistance": 30,
                        "rotatingTool.snapAngleMultiple": 15,
                        "rotatingTool.snapAngleEpsilon": 15,
                        "undoManager.isEnabled": true
                    });

            myDiagram.allowTextEdit = false;

            // Define a function for creating a "port" that is normally transparent.
            // The "name" is used as the GraphObject.portId, the "spot" is used to control how links connect
            // and where the port is positioned on the node, and the boolean "output" and "input" arguments
            // control whether the user can draw links from or to the port.
            function makePort(name, spot, output, input) {
                // the port is basically just a small transparent square
                return GOJS(go.Shape, "Circle", {
                    fill: null, // not seen, by default; set to a translucent gray by showSmallPorts, defined below
                    stroke: null,
                    desiredSize: new go.Size(7, 7),
                    alignment: spot, // align the port on the main Shape
                    alignmentFocus: spot, // just inside the Shape
                    portId: name, // declare this object to be a "port"
                    fromSpot: spot,
                    toSpot: spot, // declare where links may connect at this port
                    fromLinkable: output,
                    toLinkable: input, // declare whether the user may draw links to/from here
                    cursor: "pointer" // show a different cursor to indicate potential link point
                });
            }

            var nodeSelectionAdornmentTemplate =
                GOJS(go.Adornment, "Auto",
                    GOJS(go.Shape, {fill: null, stroke: "deepskyblue", strokeWidth: 1.5, strokeDashArray: [4, 2]}),
                    GOJS(go.Placeholder)
                );

            var nodeResizeAdornmentTemplate =
                GOJS(go.Adornment, "Spot", {locationSpot: go.Spot.Right},
                    GOJS(go.Placeholder),
                    GOJS(go.Shape, {
                        alignment: go.Spot.TopLeft,
                        cursor: "nw-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),
                    GOJS(go.Shape, {
                        alignment: go.Spot.Top,
                        cursor: "n-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),
                    GOJS(go.Shape, {
                        alignment: go.Spot.TopRight,
                        cursor: "ne-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),

                    GOJS(go.Shape, {
                        alignment: go.Spot.Left,
                        cursor: "w-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),
                    GOJS(go.Shape, {
                        alignment: go.Spot.Right,
                        cursor: "e-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),

                    GOJS(go.Shape, {
                        alignment: go.Spot.BottomLeft,
                        cursor: "se-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),
                    GOJS(go.Shape, {
                        alignment: go.Spot.Bottom,
                        cursor: "s-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),
                    GOJS(go.Shape, {
                        alignment: go.Spot.BottomRight,
                        cursor: "sw-resize",
                        desiredSize: new go.Size(6, 6),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    })
                );

            var nodeRotateAdornmentTemplate =
                GOJS(go.Adornment, {locationSpot: go.Spot.Center, locationObjectName: "CIRCLE"},
                    GOJS(go.Shape, "Circle", {
                        name: "CIRCLE",
                        cursor: "pointer",
                        desiredSize: new go.Size(7, 7),
                        fill: "lightblue",
                        stroke: "deepskyblue"
                    }),
                    GOJS(go.Shape, {
                        geometryString: "M3.5 7 L3.5 30",
                        isGeometryPositioned: true,
                        stroke: "deepskyblue",
                        strokeWidth: 1.5,
                        strokeDashArray: [4, 2]
                    })
                );

            myDiagram.nodeTemplate =
                GOJS(go.Node, "Spot", {locationSpot: go.Spot.Center},
                    new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify), {
                        selectable: true,
                        selectionAdornmentTemplate: nodeSelectionAdornmentTemplate
                    }, {
                        resizable: true,
                        resizeObjectName: "PANEL",
                        resizeAdornmentTemplate: nodeResizeAdornmentTemplate
                    }, {rotatable: true, rotateAdornmentTemplate: nodeRotateAdornmentTemplate},
                    new go.Binding("angle").makeTwoWay(),
                    // the main object is a Panel that surrounds a TextBlock with a Shape
                    GOJS(go.Panel, "Auto", {name: "PANEL"}, {desiredSize: new go.Size(120, 40)},
                        GOJS(go.Shape, "Rectangle", // default figure
                            {
                                portId: "", // the default port: if no spot on link data, use closest side
                                fromLinkable: true,
                                toLinkable: true,
                                cursor: "pointer",
                                fill: "white", // default color
                                strokeWidth: 2
                            },
                            new go.Binding("figure"),
                            new go.Binding("fill")),
                        GOJS(go.TextBlock, {
                                font: "bold 11pt Helvetica, Arial, sans-serif",
                                margin: 8,
                                maxSize: new go.Size(160, NaN),
                                wrap: go.TextBlock.WrapFit,
                                editable: true
                            },
                            new go.Binding("text").makeTwoWay())
                    ),
                    // four small named ports, one on each side:
                    makePort("T", go.Spot.Top, false, true),
                    makePort("L", go.Spot.Left, true, true),
                    makePort("R", go.Spot.Right, true, true),
                    makePort("B", go.Spot.Bottom, true, false), { // handle mouse enter/leave events to show/hide the ports
                        mouseEnter: function (e, node) {
                            showSmallPorts(node, true);
                        },
                        mouseLeave: function (e, node) {
                            showSmallPorts(node, false);
                        }
                    }, {
                        contextMenu: // define a context menu for each node
                            GOJS("ContextMenu",
                                GOJS("ContextMenuButton",
                                    new go.Binding("visible", "", function(o, e) {
                                        return o.part.adornedPart.data.cmd === "mod_source";
                                    }).ofObject(),
                                    GOJS(go.TextBlock, "Visualize output", {click: visualizeOutput})
                                ),
                            )
                    }
                );

            function showSmallPorts(node, show) {
                node.ports.each(function (port) {
                    if (port.portId !== "") { // don't change the default port, which is the big shape
                        port.fill = show ? "rgba(0,0,0,.3)" : null;
                    }
                });
            }

            var linkSelectionAdornmentTemplate =
                GOJS(go.Adornment, "Link",
                    GOJS(go.Shape,
                        // isPanelMain declares that this Shape shares the Link.geometry
                        {isPanelMain: true, fill: null, stroke: "deepskyblue", strokeWidth: 0}) // use selection object's strokeWidth
                );

            myDiagram.linkTemplate =
                GOJS(go.Link, // the whole link panel
                    {
                        selectable: true,
                        selectionAdornmentTemplate: linkSelectionAdornmentTemplate
                    }, {relinkableFrom: true, relinkableTo: true, reshapable: true}, {
                        routing: go.Link.AvoidsNodes,
                        curve: go.Link.JumpOver,
                        corner: 5,
                        toShortLength: 4
                    },
                    new go.Binding("points").makeTwoWay(),
                    GOJS(go.Shape, // the link path shape
                        {isPanelMain: true, strokeWidth: 2}),
                    GOJS(go.Shape, // the arrowhead
                        {toArrow: "Standard", stroke: null}),
                    GOJS(go.Panel, "Auto",
                        new go.Binding("visible", "isSelected").ofObject(),
                        GOJS(go.Shape, "RoundedRectangle", // the link shape
                            {fill: "#F8F8F8", stroke: null}),
                        GOJS(go.TextBlock, {
                                textAlign: "center",
                                font: "10pt helvetica, arial, sans-serif",
                                stroke: "#919191",
                                margin: 2,
                                minSize: new go.Size(10, NaN),
                                editable: true
                            },
                            new go.Binding("text").makeTwoWay())
                    )
                );

            var inspector = new Inspector('myInspectorDiv', myDiagram, {
                multipleSelection: false,
                showSize: 1,
                showAllProperties: false,
                includesOwnProperties: true,
                properties: {
                    "text": {show: false},
                    "key": {show: false},
                    "figure": {show: false},
                    "loc": {show: false},
                    "fill": {show: false},
                    "cmd": {readOnly: true}
                }
            });

            load(); // load an initial diagram from some JSON text

            // initialize the Palette that is on the left side of the page

            $.ajax({
                url: '/modules_info',
                type: 'get',
                success: function (data) {
                    contents = [];
                    for (var i in data) {
                        var obj = JSON.parse(data[i]);
                        var palette_elem = {
                            text: obj.name,
                            figure: "RoundedRectangle",
                            fill: "white",
                            cmd: obj.cmd
                        }
                        if (obj.cmd == 'mod_source') {
                            nodeTemplate = myDiagram.nodeTemplateMap
                        }
                        if ('splittable' in obj) {
                            palette_elem['splits'] = "";
                        }
                        for (var i = 0; i < obj.parameters.length; i++) {
                            var param = obj.parameters[i];
                            palette_elem[param.name] = param.default_value;
                        }
                        if ('color' in obj) {
                            palette_elem['fill'] = obj.color;
                            contents.splice(0, 0, palette_elem);
                        } else {
                            contents.push(palette_elem);
                        }
                    }
                    myPalette =
                        GOJS(go.Palette, "myPaletteDiv", // must name or refer to the DIV HTML element
                            {
                                maxSelectionCount: 1,
                                nodeTemplateMap: myDiagram.nodeTemplateMap, // share the templates used by myDiagram
                                linkTemplate: // simplify the link template, just in this Palette
                                    GOJS(go.Link, { // because the GridLayout.alignment is Location and the nodes have locationSpot == Spot.Center,
                                            // to line up the Link in the same manner we have to pretend the Link has the same location spot
                                            locationSpot: go.Spot.Center,
                                            selectionAdornmentTemplate: GOJS(go.Adornment, "Link", {locationSpot: go.Spot.Center},
                                                GOJS(go.Shape, {
                                                    isPanelMain: true,
                                                    fill: null,
                                                    stroke: "deepskyblue",
                                                    strokeWidth: 0
                                                }),
                                                GOJS(go.Shape, // the arrowhead
                                                    {toArrow: "Standard", stroke: null})
                                            )
                                        }, {
                                            routing: go.Link.AvoidsNodes,
                                            curve: go.Link.JumpOver,
                                            corner: 5,
                                            toShortLength: 4
                                        },
                                        new go.Binding("points"),
                                        GOJS(go.Shape, // the link path shape
                                            {isPanelMain: true, strokeWidth: 2}),
                                        GOJS(go.Shape, // the arrowhead
                                            {toArrow: "Standard", stroke: null})
                                    ),
                                model: new go.GraphLinksModel(contents)
                            });
                    myPalette.requestUpdate();
                }
            });
            load_models();
        };

        // Show the diagram's model in JSON format that the user may edit
        function save() {
            saveDiagramProperties(); // do this first, before writing to JSON
            document.getElementById("mySavedModel").value = myDiagram.model.toJson();
            myDiagram.isModified = false;
        };

        function load() {
            myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
            loadDiagramProperties(); // do this after the Model.modelData has been brought into memory
        };

        function load_diagram(model) {
            console.log("Loading diagram for model " + model.modelId);
            myDiagram.model = go.Model.fromJson(model);
            loadDiagramProperties(); // do this after the Model.modelData has been brought into memory
        };

        function saveDiagramProperties() {
            myDiagram.model.modelData.position = go.Point.stringify(myDiagram.position);
        };

        function loadDiagramProperties(e) {
            // set Diagram.initialPosition, not Diagram.position, to handle initialization side-effects
            var pos = myDiagram.model.modelData.position;
            if (pos) myDiagram.initialPosition = go.Point.parse(pos);
        };

        // all visualization functions 
        function visualizeOutput(e, obj) {
            var viz_path = obj.part.adornedPart.data.viz_path;
            if (viz_path == "") {
                console.log("No viz path given")
            }
            var filename = "./Data/" + viz_path;
            visualizeFile(filename);
        };

        function request_pipeline(p) {

            console.log("Requesting pipeline " + p);

            $.ajax({
                url: '/request_pipeline',
                type: 'get',
                dataType: 'text',
                contentType: "text/plain",
                data: p,
                success: function (data) {
                    console.log("success!");
                    myDiagram.model = go.Model.fromJson(data);
                    loadDiagramProperties(); // do this after the Model.modelData has been brought into memory
                    document.getElementById("mySavedModel").value = myDiagram.model.toJson();
                }
            });
        };
    </script>
</head>

<body onload="init()">
<script type="text/javascript">

    var maxModelId = 0;

    var maxSize = 1000;
    var hashTable = new Array(maxSize);
    var runCounter = [];
    var newId = false;

    // saveModelVersions(); // Use this to reset hash table and model id's, preferrably destroy all saved models before

    getModelVersions();

    function send() {

        var debugger_type = document.querySelector('input[name="debug_type"]:checked').value;

        saveDiagramProperties();
        modelJsonString = myDiagram.model.toJson();

        modelHash = getHash(modelJsonString, maxSize);

        if (hashTable[modelHash] === undefined || hashTable[modelHash] === null) {
            modelId = maxModelId;
            maxModelId += 1;
            runNo = 1;
            hashTable[modelHash] = modelId;
            runCounter[modelId] = runNo;
        } else {
            modelId = hashTable[modelHash];
            runCounter[modelId] += 1;
            runNo = runCounter[modelId];
        }

        saveModelVersions();

        modelJson = JSON.parse(modelJsonString);
        modelJson['modelId'] = modelId;
        modelJson['runNo'] = runNo;
        modelJsonString = JSON.stringify(modelJson);
        saveModel(modelJsonString);

        tracking_filters = get_tracking_filters()

        data_to_send = {
            'pipeline': modelJson,
            'debugger_type': debugger_type,
            'tracking_filters': tracking_filters
        }

        $.ajax({
            url: '/run',
            type: 'post',
            processData: false,
            data: JSON.stringify(data_to_send),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                console.log("success!");
                add_model_to_debugger(data);
                open_debugger();
            }
        });
    };
</script>
<script>
    function handleFile(files) {
        const numFiles = files.length;

        var fr = new FileReader();
        fr.onload = function (e) {
            data = e.target.result;
            myDiagram.model = go.Model.fromJson(data);
            loadDiagramProperties();  // do this after the Model.modelData has been brought into memory
            document.getElementById("mySavedModel").value = myDiagram.model.toJson();
        };
        fr.readAsText(files[0]);


    }

    function saveTextAsFile() {
        document.getElementById("mySavedModel").value = myDiagram.model.toJson();


        var pipeline_json = document.getElementById("mySavedModel").value;
        var json_as_blob = new Blob([pipeline_json], {type: "application/json"});
        var json_url = window.URL.createObjectURL(json_as_blob);
        var fname = document.getElementById("inputFileNameToSaveAs").value;


        var downloadLink = document.createElement("a");
        downloadLink.download = fname;
        downloadLink.innerHTML = "Download File";
        downloadLink.href = json_url;
        downloadLink.onclick = destroyClickedElement;
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);

        downloadLink.click();
    }

    function destroyClickedElement(event) {
        document.body.removeChild(event.target);
    }

</script>
<style type="text/css" media="screen">
    #debugger_scrollmenu::-webkit-scrollbar {
        display: none;
    }
    .ti::-webkit-scrollbar {
        display: none;
    }
</style>

<!-- Menu bar -->
<div class="w3-top" style="z-index: 5">
    <div class="w3-bar w3-light-gray">
        <a class="w3-bar-item w3-green">Data Civilizer 2.0</a>
        <a class="w3-bar-item w3-button" onclick="open_viz('visualizer');document.getElementById('header_01').scrollIntoView({behavior: 'smooth'});">Saved Pipelines</a>
        <a class="w3-bar-item w3-button" onclick="open_viz('editor');document.getElementById('header_02').scrollIntoView({behavior: 'smooth'});">Pipeline editor</a>
        <a class="w3-bar-item w3-button" onclick="open_viz('output_viz');document.getElementById('header_03').scrollIntoView({behavior: 'smooth'});">Visualize output</a>
    </div>
</div>

<hr id="header_01">
<br>

<!-- Saved pipelines header -->
<div class="w3-container">
    <button class="w3-button w3-block" onclick="toggle_viz('visualizer'); toggle_arrow('icon_models');"><b>Saved Pipelines</b><i id="icon_models" class="w3-right fa fa-angle-up" style='font-size:20px'></i></button>
</div>
<br>

<!-- Saved pipelines section -->
<div class="w3-container w3-show" id="visualizer">
    <div class="w3-container">
        <div class="w3-row">
            <div class="w3-col w3-display-container w3-light-gray" style="width: 20%; height: 400px;">
                <div class="w3-container" style="padding: 0px; height: 362px; overflow-y: hidden;">
                    <div class="w3-container w3-center"><h5><b>Filter by</b></h5></div>
                    <button class="w3-button w3-block w3-left-align" onclick="toggle_viz('accordion_01');toggle_arrow('icon_accordion_01');">Parameters <i id="icon_accordion_01" class="fa fa-angle-down" style='font-size:20px'></i></button>
                    <div id="accordion_01" class="w3-container w3-bar-block w3-border w3-hide parameters" style="width: 100%; max-height: 150px; overflow-y: auto; padding: 0px;"></div>
                    <button class="w3-button w3-block w3-left-align" onclick="toggle_viz('accordion_02');toggle_arrow('icon_accordion_02');">Metrics <i id="icon_accordion_02" class="fa fa-angle-down" style='font-size:20px'></i></button>
                    <div id="accordion_02" class="w3-container w3-bar-block w3-border w3-hide metrics" style="width: 100%; max-height: 150px; overflow-y: auto; padding: 0px;"></div>
                </div>
                <button class="w3-display-bottom w3-button w3-block w3-border" onclick="load_models()">Refresh</button>
            </div>
            <div class="w3-rest w3-center" style="height: 400px; overflow-y: auto;">
                <div class="w3-container models" id="models"></div>
            </div>
        </div>
    </div>
</div>

<hr id="header_02">
<br>

<!-- Pipeline editor header -->
<div class="w3-container">
    <button class="w3-button w3-block" onclick="toggle_viz('editor'); toggle_arrow('icon_editor');"><b>Pipeline editor</b><i id="icon_editor" class="w3-right fa fa-angle-up" style='font-size:20px'></i></button>
</div>
<br>

<!-- Pipeline editor section -->
<div class="w3-container w3-show" id="editor">
    <div id="sample">
        <div class="w3-container">
            <div id="workBench" class="w3-row">

                <div class="w3-col w3-light-gray" style="width: 20%;">
                    <button class="w3-button w3-block w3-border" onclick="document.getElementById('modal_02').style.display='block'">Load pipeline</button>
                     <div class="w3-border" id="myPaletteDiv" style="height: 600px;"></div>
                </div>

                <div class="w3-col w3-light-gray" id="diagram" style="width: 80%;">
                    <button class="w3-button w3-block w3-border w3-border-green w3-hover-border-gray w3-green" onclick="document.getElementById('modal_01').style.display='block'">Execute Pipeline</button>
                    <div class="w3-border" id="myDiagramDiv" style="height: 600px;"></div>
                </div>

                <div class="w3-col debugger w3-hide" id="debugger" style="width: 40%; height: 600px;">
                    <div class="w3-container" id="debugger_scrollmenu" style="padding: 0px;height: 40px; white-space: nowrap; overflow: auto;"></div>
                    <div class="w3-container w3-border" id="debugger_models" style="height: 600px;"></div>
                </div>
            </div>
        </div>

        <br>

        <div class="w3-container">
            <button class="w3-button w3-block w3-left-align w3-light-gray" onclick="toggle_viz('selected_parts'); toggle_arrow('icon_params');">Parameters<i id="icon_params" class="w3-right fa fa-angle-down" style='font-size:20px'></i></button>
        </div>

        <div class="w3-container w3-hide" id="selected_parts">
            <br>
            <div class="w3-container">
                <div class="w3-container w3-border-bottom">Selected Part:</div>
                <div class="w3-container" id="myInspectorDiv"></div>
            </div>
        </div>

        <br>

        <div class="w3-container">
            <button class="w3-button w3-block w3-left-align w3-light-gray" onclick="toggle_viz('tracking_info'); toggle_arrow('icon_tracking');">Tracking<i id="icon_tracking" class="w3-right fa fa-angle-down" style='font-size:20px'></i></button>
        </div>

        <div class="w3-container w3-hide" id="tracking_info">
            <div id="tracking_filter_form" class="tracking_filter_form">
                <br>
                <div class="w3-container">
                    <div class="w3-container w3-border-bottom">Tracking filters:</div>
                    <ul class="w3-ul" id="tracking_filters">
                    </ul>
                </div>
                <br>
                <div class="w3-container">
                    <div class="w3-container w3-border-bottom">Add or remove tracking filter:</div>
                    <div class="w3-margin w3-row-padding">
                        <div class="w3-panel w3-border-bottom w3-quarter">Id filter</div>
                        <div class="w3-quarter">
                            <input id="tracking_form_input_01" class="w3-input" type="number" min="0" placeholder="Id">
                        </div>
                        <div class="w3-quarter w3-right">
                            <button class="w3-border-bottom w3-button w3-block" onclick="add_filter('id')">Add</button>
                        </div>
                    </div>
                    <div class="w3-margin w3-row-padding">
                        <div class="w3-panel w3-border-bottom w3-quarter">Id range filter</div>
                        <div class="w3-quarter">
                            <input id="tracking_form_input_02" class="w3-input" type="number" min="0" placeholder="From (inclusive)">
                        </div>
                        <div class="w3-quarter">
                            <input id="tracking_form_input_03" class="w3-input" type="number" min="0" placeholder="Until (not inclusive)">
                        </div>
                        <div class="w3-quarter w3-right">
                            <button class="w3-border-bottom w3-button w3-block" onclick="add_filter('id_range')">Add</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="w3-container w3-hide">
            <textarea id="mySavedModel" style="width:100%;height:300px">
                { "class": "go.GraphLinksModel",
                  "linkFromPortIdProperty": "fromPort",
                  "linkToPortIdProperty": "toPort",
                  "nodeDataArray": [
                 ],
                  "linkDataArray": [
                 ]}
            </textarea>
        </div>
    </div>
</div>

<br>
<hr id="header_03">
<br>

<!-- Vizualize output header -->
<div class="w3-container">
    <button class="w3-button w3-block" onclick="toggle_viz('output_viz'); toggle_arrow('icon_viz');"><b>Visualize output</b><i id="icon_viz" class="w3-right fa fa-angle-up" style='font-size:20px'></i></button>
</div>

<!-- Vizualize output section -->
<div class="w3-container w3-center w3-margin w3-show" id="output_viz">
    <div class="w3-row" id="edv_div" style="height: 600px;">
        <div class="w3-quarter w3-hide" id="edv_list_div" style="height: 600px; overflow-y: auto;">
            <ul class="w3-ul w3-left w3-left-align" id="edv_list">
            </ul>
        </div>
        <div class="w3-rest" id="edv_iframe_div">
            <div class="w3-border w3-border-black dragscroll" id="myDiv" style="overflow: hidden; background-color: white; width: 100%; height: 600px">
                <iframe name="myIframeName" id="iframeViz" width="0" height="0" scrolling="no" style="pointer-events: none; border: none;"></iframe>
            </div>
        </div>
    </div>
    <br>
    <div class="w3-container w3-border w3-border-black w3-hide" id="graph_viz_div" style="padding: 0px; width: 100%; height: 600px;">
        <div class="w3-row" style="height: 50%;">
            <div class="w3-half" style="height: 100%;">
                <canvas id="myChart1" width="100%" height="100%"></canvas>
            </div>
            <div class="w3-half" style="height: 100%;">
                <canvas id="myChart2" width="100%" height="100%"></canvas>
            </div>
        </div>
        <div class="w3-row" style="height: 50%;">
            <div class="w3-half" style="height: 100%;">
                <canvas id="myChart3" width="100%" height="100%"></canvas>
            </div>
            <div class="w3-half" style="height: 100%;">
                <canvas id="myChart4" width="100%" height="100%"></canvas>
            </div>
        </div>
    </div>
</div>

<br>

<!-- Execute pipeline modal -->
<div id="modal_01" class="w3-modal">
    <div class="w3-modal-content w3-animate-top">
        <div class="w3-container w3-green">
            <h4>Execute pipeline<i onclick="document.getElementById('modal_01').style.display='none'" class="w3-button w3-right fa fa-times"></i></h4>
        </div>
        <div class="w3-container">
            <br>
            <div class="w3-container">Execution type</div>
            <div class="w3-row-padding">
                <div class="w3-quarter">
                    <input class="w3-radio" type="radio" name="debug_type" value="no_split" checked>
                    <label>No split</label>
                </div>
                <div class="w3-quarter">
                    <input class="w3-radio" type="radio" name="debug_type" value="clean">
                    <label>Clean</label>
                </div>
                <div class="w3-quarter">
                    <input class="w3-radio" type="radio" name="debug_type" value="dirty">
                    <label>Dirty</label>
                </div>
            </div>
            <br>
            <hr>
            <div class="w3-row-padding">
                <div class="w3-quarter w3-right">
                    <button class="w3-button w3-block w3-left-align w3-border" onclick="document.getElementById('modal_01').style.display='none';">Cancel</button>
                </div>
                <div class="w3-quarter w3-right">
                    <button class="w3-button w3-block w3-left-align w3-border w3-border-green w3-hover-border-gray w3-green" onclick="send();document.getElementById('modal_01').style.display='none';">Start</button>
                </div>
            </div>
            <br>
        </div>
    </div>
</div>

<!-- Load pipeline modal -->
<div id="modal_02" class="w3-modal">
    <div class="w3-modal-content w3-animate-top">
        <div class="w3-container w3-green">
            <h4>Load pipeline pipeline<i onclick="document.getElementById('modal_02').style.display='none'" class="w3-button w3-right fa fa-times"></i></h4>
        </div>
        <div class="w3-container">
            <br>
            <div class="w3-container">Load pre-defined pipeline</div>
            <br>
            <div class="w3-container">
                <div class="w3-bar">
                    <button class="w3-bar-item w3-button w3-border" onclick="request_pipeline('ml_nn_pipeline');document.getElementById('modal_02').style.display='none'">ML 1</button>
                    <button class="w3-bar-item w3-button w3-border" onclick="request_pipeline('ml_bcnn_pipeline');document.getElementById('modal_02').style.display='none'">ML 2</button>
                    <button class="w3-bar-item w3-button w3-border" onclick="request_pipeline('ml_fmnn_pipeline');document.getElementById('modal_02').style.display='none'">ML 3</button>
                    <button class="w3-bar-item w3-button w3-border" onclick="request_pipeline('ml_bcfmnn_pipeline');document.getElementById('modal_02').style.display='none'">ML 4</button>
                    <button class="w3-bar-item w3-button w3-border" onclick="request_pipeline('eeg_preprocessing_pipeline');document.getElementById('modal_02').style.display='none'">EEG processing (good)</button>
                    <button class="w3-bar-item w3-button w3-border" onclick="request_pipeline('eeg_processing_wrong_param_pipeline');document.getElementById('modal_02').style.display='none'">EEG preocessing (bad)</button>
                    <button class="w3-bar-item w3-button w3-border" onclick="request_pipeline('spectrogram_pipeline');document.getElementById('modal_02').style.display='none'">Spectrogram</button>
                </div>
            </div>
            <br>
            <div class="w3-container">Load pipeline from file</div>
            <br>
            <div class="w3-container">
            <input type="file" id="input" class="form-control-file" onchange="handleFile(this.files);document.getElementById('modal_02').style.display='none'">
            </div>
            <br>
            <hr>
            <div class="w3-row-padding">
                <div class="w3-quarter w3-right">
                    <button class="w3-button w3-block w3-left-align w3-border" onclick="document.getElementById('modal_02').style.display='none';">Close</button>
                </div>
            </div>
            <br>
        </div>
    </div>
</div>
</body>

</html>
